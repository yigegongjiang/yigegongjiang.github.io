---
title: 为什么32位操作系统只能用4G内存空间
date: 2019-02-26 19:04:53
categories:
- 技术
tags:
- 计算机原理
- 内存
---


### 字节与比特

`比特是计算机存储的最小存储单元`。我们认知到的数字`3`，在计算机的存储里（硬盘或者内存）的结构是这样的：`00000011`，也就是我们理解的二进制。
所以这个数字`3`是由8位组成的。每位有`0`和`1`两种变化。
比特存储，是计算机的基石。我们在互联网上通行的一切，如图片、音视频、文字，甚至各位的博客、App、电子书等等，能想到的能通过互联网传输的一切，都是比特存储。
举个例子，我们看的一张图片，在磁盘上的存储，或许就是这样子：`0101011101010101010111101011110101010101100***(省略100000000个)***1010100111010101`。

1字节(byte)=8比特(bit)
我们刚才说到的数字`3`，就是一个字节，在磁盘上就是`00000011`。（为了便于理解，实际可能是`00000000 00000011`，或者`00000000 00000000 00000000 00000011`）。

1KB = 1024B（2的10次方）
1MB = 1024KB（2的10次方）
1GB = 1024MB（2的10次方）
这些大小的计算都是定死的规则。规则很重要，有了规则才能合作。

<!-- more -->

### 内存条

实实在在的东西，有4GB、8GB、16GB等大小，长条形的带黑边的玩意，实体店网店都能买到，笔记本的小一些，台式机的大一些，有各种型号。手机都是用的贴片系统 SOC，内存条都集成到了主板上。
如果电脑开机的时候出现`滴滴滴`的声音，就把内存条拔出来檫檫，有很大概率能好，这是台式机时候的老梗。
**内存条根本性决定了我们可用的最大内存。**如果内存只有一个G，不管CPU和操作系统怎么高配，也只有一个G的内存能用。

内存条是硬件存储设备。很容易能支持8GB的数据存储。8GB = 8G \* 1024M \* 1024K \* 1024Byte，也就是`8589934592`Byte(字节)，`8589934592 * 8`即`68719476736`Bit（比特）。

### CPU

**CPU一定程度上影响了最大内存。**
我们经常说的32位操作系统或者64位操作系统，其实说的就是CPU里面核心的寄存器是 32 位还是 64 位！
寄存器是由多个**集成电路元件IC**组合成的。CPU上有数据总线的针脚，可以和内存条一一对应，这里就有数据总线、地址总线、控制总线三大总线了。
如果CPU的数据总线有32个针脚，并且和内存条上面的32个数据总线针脚一一对应连接，那么就可以一次进行32比特的数据传输，也就是一次4个字节。
数据在CPU和内存双向流动的帮手就是寄存器。所以寄存器也要有一次处理32比特数据的能力，所以这个时候寄存器也是32位的。
CPU中的寄存器决定我们的操作系统是`32位`还是`64位`（甚至8位，16位等）。这里的`32位`和`64位`，指的是寄存器的位数，而非内存地址的长度。寄存器位数越大，那么一次处理数据的能力越强。比如32位寄存器一次可以处理4字节数据，64位寄存器一次可以处理8字节数据。

### 主板-地址总线
上面我们说的CPU一定程度上影响最大内存，但不是根本原因。
**地址总线**影响的是内存空间寻址范围。**地址总线硬件决定了我们可用的最大内存。**
在CPU和内存条上，有两个重要的线，一个是数据总线，一个是地址总线。因为CPU和内存条本质也不是互通的，他们都需要插在主板上面，所以主板是他们沟通的桥梁。

上面我们说到8G的内存条，有68719476736比特的数据，逆过来分析一下：
这么大的比特数据，在内存条是按照8Bit一组排列的。
每8Bit形成一个小房间。所以8GB的内存条里面，有`68719476736 / 8`个房间。
计算机操作系统可以通过`定向寻址`的方案，直接找到每个房间。形象来说，就是每个房间都有一个`内存地址`,系统通过`内存地址`就可以瞬间找到那个房间，房间里面有8个小人(8Bit)。

`内存地址`是关键，就由地址总线来指向和控制。如果地址总线有32条，那么`内存地址`最小为：`00000000 00000000 00000000 00000000`，最大为：`11111111 11111111 11111111 11111111`。64条就`00000000 00000000 00000000 00000000 00000000 00000000 00000000 00000000`和`11111111 11111111 11111111 11111111 11111111 11111111 11111111 11111111`。
对于32条地址总线来说，这最小和最大之间，有多少个呢？因为每个Bit有`0`和`1`两个选择，所以总共有2的32次方个。每一个都一一对应内存条里面的一个房间，所以最多可以对应`2*2*2*2(32个2相乘)=4294967296`个房间。
每个房间是8Bit即1Byte(字节)，也就是总房间大小为:`4294967296Byte`，也就是`4294967296Byte/1024K/1024M/1024G = 4GB`。
**对于32条地址总线，最大的内存地址也就是：`11111111 11111111 11111111 11111111`。也就是最多只能找到`2*2*2*2(32个2相乘)=4294967296`个房间。也就是最大内存查找范围只有`4294967296Byte/1024K/1024M/1024G = 4GB`。**

### 数据总线和地址总线的关联
上面说了数据总线和地址总线，我们知道了数据总线用来传输数据，地址总线用来定位地址。
数据总线和地址总线的数量是不固定的，比如window操作系统，32位，那么数据总线是32条，而地址总线可能是32条，也可能是36条。
如果地址总线是32条，那么最大内存就是4G，如果有36条，那么最大内存就是64G了。

如果32位数据总线，配36位地址总线，那么一次只能传输32位数据，数据对应的地址却是36位，寄存器这样看存不下来嘛，因为寄存器少了4位。这个时候可以通过位移动，将两个 32 位的地址变成 36 位。
如果64位数据总线，配36位地址总线，那么一次能传输64位数据，而数据对应的地址却只有36位。这样只要把高位补0就可以了，这也是为什么64位操作系统能够兼容32位软件的原因。虽然浪费了空间，但是能兼容。
64位数据总线配64位地址总线？2的64次数，实在太大了，就是ipv6的数量。所以根本配不了64条地址总线，就是配了，也没有这么大的内存可以叠加啊。所以一般都配40-50条地址总线就差不多了。

### 为什么32位操作系统只能用4G内存空间

当年win7系统，明明买了8G的内存条，到`我到电脑`里面一看，只有4G不到。其余到4G不见了。
其实不是不见了，它还在那里，只是地址总线只有32条，导致读取不了更多到内存空间了。
___

C绝对是计算机语言的开荒基石。
熟练C的程序员，大脑里就有一片星辰大海。
