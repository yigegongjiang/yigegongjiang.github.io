<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.0.0-rc2">
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.20/fancybox/fancybox.css" integrity="sha256-RvRHGSuWAxZpXKV9lLDt2e+rZ+btzn48Wp4ueS3NZKs=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.yigegongjiang.com","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.18.1","exturl":true,"sidebar":{"position":"left","width":140,"display":"post","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":{"gitalk":{"text":"Light Mode (Better for light mode to discuss, base github, cannot commen can email me)","order":-2},"utterances":{"text":"Dark Mode","order":-1}},"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":false,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="前两天，我和同事需要做一个功能，是把 js 前端保存到 app 本地的图片给读取出来。桥接层只有一个 saveFile 函数可供使用，定义如下： 123saveFile(string name, string content) &#123;  &#x2F;&#x2F; xxx&#125;  我同事说可以让前端把 jpg 图片直接保存，我们直接去拿图片就好了。看这个接口的入参是 string 类型，我说这可能不行，得依">
<meta property="og:type" content="article">
<meta property="og:title" content="文件存储差异-编码">
<meta property="og:url" content="https://www.yigegongjiang.com/2022/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E5%B7%AE%E5%BC%82-%E7%BC%96%E7%A0%81/index.html">
<meta property="og:site_name" content="一个工匠">
<meta property="og:description" content="前两天，我和同事需要做一个功能，是把 js 前端保存到 app 本地的图片给读取出来。桥接层只有一个 saveFile 函数可供使用，定义如下： 123saveFile(string name, string content) &#123;  &#x2F;&#x2F; xxx&#125;  我同事说可以让前端把 jpg 图片直接保存，我们直接去拿图片就好了。看这个接口的入参是 string 类型，我说这可能不行，得依">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-07-10T11:16:13.000Z">
<meta property="article:author" content="海驴">
<meta property="article:tag" content="计算机原理">
<meta property="article:tag" content="编码">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.yigegongjiang.com/2022/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E5%B7%AE%E5%BC%82-%E7%BC%96%E7%A0%81/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://www.yigegongjiang.com/2022/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E5%B7%AE%E5%BC%82-%E7%BC%96%E7%A0%81/","path":"2022/文件存储差异-编码/","title":"文件存储差异-编码"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>文件存储差异-编码 | 一个工匠</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="一个工匠" type="application/atom+xml">
<link rel="alternate" href="/rss2.xml" title="一个工匠" type="application/rss+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">一个工匠</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags<span class="badge">13</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories<span class="badge">7</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives<span class="badge">80</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>About</a></li><li class="menu-item menu-item-rss"><a href="/rss2.xml" rel="section"><i class="rss fa-fw"></i>Rss</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E6%9C%AC%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E7%AE%80%E8%A6%81%E8%AF%B4%E6%98%8E"><span class="nav-number">1.</span> <span class="nav-text">文本文件存储简要说明</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8"><span class="nav-number">2.</span> <span class="nav-text">可执行文件如何存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%8D%E8%B0%88%E5%86%85%E5%AD%98%E7%BC%96%E7%A0%81%E5%88%B0%E5%BA%95%E6%98%AF%E4%B8%8D%E6%98%AF-utf16-%E4%BB%A5%E5%8F%8A%E5%85%B6%E6%84%8F%E4%B9%89"><span class="nav-number">3.</span> <span class="nav-text">再谈内存编码到底是不是 utf16 以及其意义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E6%96%87%E4%BB%B6%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8"><span class="nav-number">4.</span> <span class="nav-text">图片文件如何存储</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="海驴"
      src="https://cdn.jsdelivr.net/gh/yigegongjiang/image_space@main/blog_img/202309220309178.webp">
  <p class="site-author-name" itemprop="name">海驴</p>
  <div class="site-description" itemprop="description">时间，真的不多了。</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">80</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
        <div class="pjax">
        </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.yigegongjiang.com/2022/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E5%B7%AE%E5%BC%82-%E7%BC%96%E7%A0%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/yigegongjiang/image_space@main/blog_img/202309220309178.webp">
      <meta itemprop="name" content="海驴">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="一个工匠">
      <meta itemprop="description" content="时间，真的不多了。">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="文件存储差异-编码 | 一个工匠">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          文件存储差异-编码
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2022-07-10 19:16:13" itemprop="dateCreated datePublished" datetime="2022-07-10T19:16:13+08:00">2022-07-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>前两天，我和同事需要做一个功能，是把 js 前端保存到 app 本地的图片给读取出来。桥接层只有一个 saveFile 函数可供使用，定义如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">saveFile</span>(<span class="params">string name, string content</span>) &#123;</span><br><span class="line">  <span class="comment">// xxx</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我同事说可以让前端把 jpg 图片直接保存，我们直接去拿图片就好了。看这个接口的入参是 string 类型，我说这可能不行，得依靠 base64。同事想了一下，说图片也是二进制存储的，和文本形式上是一样的，应该有一种方式把 jpg 图片转一下，然后就可以通过这个接口保存到本地并且还是 jpg 的图片。<br>然后呢，我就想到了很多年前，我向另一个同事说需要一张 png 图片，这种 jpg 的不行。然后同事给了我 png 图片后，我这边问题还是无法解决。查了很久的 bug，发现同事是把 <strong>.jpg</strong> 的后缀改成了 <strong>.png</strong> 然后给我的 :(<br>所以呢，这次还是继续聊下编码。之前有聊过一次，也比较深入了，详见 <a href="https://www.yigegongjiang.com/2019/%E8%AE%A1%E7%AE%97%E6%9C%BAUnicode%E7%BC%96%E7%A0%81%E7%BB%88%E7%BB%93/">计算机 Unicode 编码终结</a>，那片对文本编码做了详解。这次我要聊聊二进制文件和文本文件的存储差异。二进制文件有常见的图片文件和应用程序的可执行文件。</p>
<span id="more"></span>

<h3 id="文本文件存储简要说明"><a href="#文本文件存储简要说明" class="headerlink" title="文本文件存储简要说明"></a>文本文件存储简要说明</h3><p>在 <a href="https://www.yigegongjiang.com/2019/%E8%AE%A1%E7%AE%97%E6%9C%BAUnicode%E7%BC%96%E7%A0%81%E7%BB%88%E7%BB%93/">之前文章</a> 中深入说明过编码，当时虽然没有对文本文件存储做解释，但理解起来应该没有问题的。<br>简单来说，就是文本文件存储目前大多用的 utf8，用 utf16&#x2F;gtk 也都没有问题。只要用同一种编码进行读写就不会乱码。<br>当时说内存使用的是 utf16 编码，说的有些简单了。对于字符串的内存存储，大多使用的 utf16，主要鉴于速度的考虑，比如对内容进行增删改查会更快（这里说的是字符串的内存存储。像 char&#x2F;int&#x2F;long 这些，都会按照对应的字节大小进行内存存储）。<br>但是这里只能说大多是使用的 utf16，其实具体使用 utf16，还是 utf8，是依靠编程语言本身决定的，而不是操作系统决定的。这里我们假设是 utf16，具体的在 <strong>可执行文件如何存储</strong> 章节里面再做说明。<br>所以我们用 IDE 打开文件写代码的时候，流程是这样的：</p>
<ol>
<li>原始代码文件 <strong>person.c</strong> 通过 utf8 存储在磁盘上。</li>
<li>IDE 通过系统调用读取原始代码文件，文件内容 (1、0 这些二进制数）被读入文件缓冲区，而后 IDE 从文件缓冲区拿到这些 utf8 编码的文本数据。</li>
<li>IDE 通过 utf8 对文本内容进行解码，拿到了 <strong>struct Person {int age &#x3D; 18;}</strong> 这些字符串。IDE 拿到这些字符串是没有用的，它也需要把这些字符串表示出来才有意义，它也需要有一个地方保存这些字符串，然后才能系统调用到输出，给到显示器。</li>
<li>于是 IDE 内部也会有一行代码 <strong>string codes &#x3D; readFromFile(“.&#x2F;person.c”)</strong> ，这样就把 <em>person.c</em> 的代码内容读取到了 <em>codes</em> 变量中进行后续的显示器输出。</li>
<li>这里就有一个重点：codes 是存储在内存里面的，可能是栈或者堆，但一定是在内存里面的。这个 codes 变量所对应的字符串内存内容，是 utf16 编码（如上所说，大部分是 utf16，但也可以是其他编码）。</li>
<li>然后开发同学把文件内容修改成了 <strong>struct Person {int age &#x3D; 28;}</strong> ，年龄改大了十岁。这个时候改动的是内存数据，而不是磁盘数据。所以蓝屏才那么可怕。</li>
<li>开发同学按 <strong>ctrl&#x2F;command + s</strong> 的时候，打算保存文件。这个时候，IDE 将文本内容转成 utf8 编码，存储到文件缓冲区，最后保存到磁盘。</li>
</ol>
<p>上面就是大概流程了。核心点是文件的磁盘存储是 utf8，内存存储是 utf16。而这个转码操作上面说是 IDE，也不全是。<br>IDE 读取和写入文件的时候会调用更下层的接口如：<strong>readLineFromFile(‘文件句柄’,’utf8’);appendWordToFile(‘文件句柄’,’utf8’,’追加文本内容’);</strong> 。所以是下层接口干了这个 utf8 -&gt; utf16 和 utf16 -&gt; utf8 的事情，IDE 只要定义 <strong>codes</strong> 这个变量就好了，顺带指定一下编码。下层接口一般是集成开发 SDK 或者对应语言 SDK 所完成的。<br>通过 <strong>readLineFromFile&#x2F;appendWordToFile</strong> 这两个接口，也可以发现其实磁盘文件的编码也可以是其他类型如 utf16&#x2F;gtk，只要业务层通过同一个编码进行磁盘文本的读写，就不会乱码。</p>
<h3 id="可执行文件如何存储"><a href="#可执行文件如何存储" class="headerlink" title="可执行文件如何存储"></a>可执行文件如何存储</h3><p>可执行文件的存储是有别于文本文件的（这里可执行文件是静态语言编译后的文件如 C，非 js 等解释执行的文件）。<br>文本文件存储的重点在于编码，如一个字 <strong>A</strong> 通过 utf8 和 utf16 都可以编码存储，用 utf8 就是 <em>0100 0001</em> ，用 utf16 就是 <em>0000 0000 0100 0001</em> 。编码不同字节数不同，但是写入磁盘的都是 1、0 这些二进制数。<br>可执行文件的存储，和文本文件其实完全一样，也都是 1、0 这些二进制数，但重点就在于编码上。即存入的也是 1 和 0，但存储的内容不一样。我们来看看如何理解可执行文件的编码。<br>假设有常量 <strong>const short stopTimeForHour &#x3D; 22;</strong> 。我们定义了一个停止的小时刻度是晚上 22 点。在可执行中的存储，肯定不会存储这么一大坨。<br>只需要在常量区开辟 2 个字节大小的空间存储 22 即可，即 <strong>0000 0000 0001 0110</strong> 。<br>如果需要读取 stopTimeForHour 的值如 <strong>printf(“%hd”,stopTimeForHour)</strong> ，<br>首先 22 已经存储在可执行文件的常量区，stopTimeForHour 只是助记符号供编译器进行指针引用，<br>其次 short 的大小是通过汇编指令进行读取的。两个字节用 mov 就可以搞定 (movb 和 movl 分别对应一个和四个字节），读取汇编就像这样：<strong>mov 0x729785409 %esi</strong> ,<br>然后，mov 是指令，esi 是寄存器，都可以通过指令和寄存器对应的译码表示，如 <strong>34 0x729785409 27</strong> ，<br>最后，编译器会做优化，这里的 22 可能会在编译的时候直接被使用而不是从常量区二次读取，就像这样：<strong>35 0x16 27</strong>(22 的十六进制是 0x16，1 个字节就可以表达，也算做编译器优化。只有一个字节，可以使用 movb，假设译码是 35)，<br>所以最后的二进制存储，或许是这样的：<strong>0010 0011(35, 假设代表 movb) 0001 0110(22) 0001 1011(27, 假设代表 esi 寄存器）</strong> 。</p>
<p>从上面可以看到，可执行文件的编码和文本 Unicode 有一些差异。数字 22 如果用文本 Unicode 存储至少也需要 2 个字节，即 0011 0010(2) 0011 0010(2)。(2 的 ASCII 是 50)。<br>但是在可执行文件里面，只在单独存储 22 的常量区，开辟了 1-2 个字节大小，即 <strong>0001 0110</strong> 。调用它的地方也通过指令换算的形式，和代码的文本形式差异非常大。<br>上面我们用 short 做特例说明了非字符串类型的存储，其中 char、int、long、float 这些都和 short 是一样的表现。</p>
<p>如果我们定义了字符串如 <strong>string name &#x3D; “MYNAME”;</strong> ，那么 string 和 name 都可以不放入文件，但是 <strong>MYNAME</strong> 是一定要放进去的，它会怎么存储？如果这个 name 是英文的表达的不够纯粹，那么这个呢？<strong>string name &#x3D; “韩梅梅”;</strong> 。我们可以发现，“韩梅梅”是中文，肯定不能通过 acsii 存储。而支持中文的，我们知道的有 gtk&#x2F;utf8&#x2F;utf16 这些。<br>进一步，只要是文字，就一定需要一个编码，英文字符串还不明显，中文就可以直观的看到，如果我们需要把“韩梅梅”这个 name 存入二进制文件，那么肯定是需要编码的。我们可以通过反证法来验证，如果我们存入的字符串不用编码，那么：</p>
<ol>
<li>我们如何把“韩梅梅”这三个汉字做存储？毕竟后面二进制文件运行的过程中还是需要读取的。</li>
<li>如果像 short 那样二进制存进去，先得有二进制序列我们才能存。数字 22 的二进制序列可以是 1 个字节 <strong>0001 0110</strong> ，那么”韩梅梅“在没有编码的前提下，二进制序列是什么？</li>
</ol>
<p>通过这样的反证，可以初步得出一个结论，那就是“韩梅梅”一定是通过一个编码，转成了特定的二进制序列，然后才能存储到二进制文件中的。</p>
<p>这里可以先说一个结论，那就是二进制文件中的字符串编码的格式，不同语言的实现还不太一样。比如 java、phthon 这些，都是通过 utf16 实现的。而 C，本身没有字符串的概念，字符串就是一个个 8 位组合数据然后尾部加上‘\n’符代表结束这样拼接起来的，而 8 位的内容可以依靠编码定义，比如 utf8 可以做到 <strong>1110xxxx 10xxxxxx 10xxxxxx</strong> 这样的 3 字节编码。C 可以通过 utf8&#x2F;utf16 做存储。<br>上面的字符串定义 <strong>string name &#x3D; “韩梅梅”;</strong> 对于 name 这个内存数据，又是使用什么编码呢？还是前面的反证法，它一定有一个编码。name 内存是通过 mov 指令读取代码区的“韩梅梅”的二进制内容然后存储到内存中的。<br>这里再说一个结论，name 字符串内存数据使用的编码和二进制字符串使用的编码，是一样的。这样就可以做到：<strong>读取二进制数据的时候，直接将二进制的字节读取后放到对应的内存区域就可以了，非常快。快到不需要解码，单纯的读取&amp;复制。而这，也是可执行文件所需要的</strong> 。</p>
<p>从上面 short 和 string 两个事例，可以发现二进制文件的存储编码，是和二进制文件运行起来后的内存编码一致的。比如 short 在内存里面是 1 个字节，那么二进制文件里面存储的也是 1 个字节。string 在内存里面是 utf8，那么二进制文件里面存储的也是 utf8。<br>对于 short 我们上面分析的没有犹豫，只是 string 我们说到不同语言的实现不太一样。其实准确来说，语言本身不在乎编码是什么，语言本身不会解析编码。<br>不管对于 Java 还是 C，只要 string 被存储到二进制文件然后被 copy 到内存区域就可以了。同一个汉字“一”，我们在 Java 下内存存储大小是 2 个字节，在 C 里面却是 4 个字节（一的 utf8 是 3 字节，尾部还需要一个‘\n’结束符）。但，没有关系。因为语言本身对这些并不感冒，我们开发人员只在必要的时候取一下大小或者做增删改查即可，不同的编码并不会影响开发人员的这些操作。当然为了快，其他更多的语言都使用 utf16 这样子。</p>
<p>所以可执行文件的存储编码也叫做值编码。即这个数据用什么编码，是和它的类型有关。它不是普通的文本，而是有特定类型，比如 char 或者 int 或者 string。<br>如果是 char 那就是 1 字节，如果是 short 那大概率是 2 字节<br>如果是 string 字符串，那么和文本编码一样，还是得有一个编码才行。这里不同的语言实现不一样。java 和 python 等一大众语言都使用 utf16 编码，因为 utf16 在增删改查的时候足够快。但 C 语言的实现其实是和代码源文件及操作系统有关。在 mac&#x2F;linux 系统下，是和代码源文件保持一致，即大多情况下是 utf8，前些年 gtk 盛行的时候也会是 gtk。在 window 下和本地环境有关，也有可能是 gtk 或者 utf8。</p>
<p>还有一点说明，拿 ELF 可执行文件的文件头魔数来举例，在 ELF 文件头中，Magic 占据 4 个字节大小，表示为：<strong>7f 45 4c 46</strong> 。这是十六进制表示，通过 ASCII 换算一下就是 <strong>DEL（一个删除符号） E L F</strong> 。每一个 ELF 的可执行文件的文件头中都有这四个字节，应用程序的装载器也会先读取这四个字节验证是否为“ELF”字符，来判断文件是否合法。<br>所以可执行文件的内容，更多是通过字节的读取来完成的。比如程序运行起来后，虚拟内存到物理内存换页的时候，指令的取码、译码全都是通过多字节操作来完成的。即特定的字节就有特定的含义。<br>而文本文件更多的不是字节的概念，把文本内容加载到文件缓冲区后就可以不停的解码了，只要编码和解码是同一样，就可以不停的解下去。其实这也和下面的“图片编码”有极大的相似度，后文再说。</p>
<h3 id="再谈内存编码到底是不是-utf16-以及其意义"><a href="#再谈内存编码到底是不是-utf16-以及其意义" class="headerlink" title="再谈内存编码到底是不是 utf16 以及其意义"></a>再谈内存编码到底是不是 utf16 以及其意义</h3><p>上面说到，内存编码对于不同类型，有不同的编码表现。其中 char、int 这些都是纯粹的字节型存储，而 string 则有一些差异，但更多的语言都是使用的 utf16。<br>可能有人会有疑问，为什么语言对不同的 string 编码不感冒？如果要调用 printf 函数做显示器上的输出，也和 string 编码无关吗？</p>
<p>其实，还是有一些关系的，但不强。调用 printf 在显示器上做输出，本质上和写入文件是一样的，毕竟显示器也是输出，和文本文件性质一样。<br>如果我们把程序运行中的数字 1 写入文件，那么文件里面也是 1。其实这是有些不合理的，因为程序运行中的数字 1，二进制编码是 <strong>0000 0001</strong> ，而存储文件里面的 1，二进制编码是 <strong>0101 0000（1 的 aceii 编码是 50）</strong> 。那么内存里面的 1，是如何变成字符串的呢？肯定要转码！只要想通过字符串写入文件，就一定需要转码！所以底层其实帮我们做了这些事情，我们不用去操心。我们只需要在调用 <strong>writeIntToFile(‘文件句柄’,’utf8’,1)</strong> 这个接口的时候，传一下编码类型，内部会把 int 1 变成 string 1 然后按照编码写入文件。像 <em>writeIntToFile</em> 的接口其实也没有，更多的时候是我们将 int 自己转成 string 或者 data，然后自己写入文件，但编码这个参数还是必不可少的。<br>显示器和文件其实是一样的，没有太多差别。要说有差别，就是<strong>显示器显示的内容，就是根据码表转换后的内容</strong>。<strong>我们前面说到的 Unicode 其实就是一张大码表，GTK 也是</strong>。只要我们把字符串编码后的二进制+编码给到系统调用，系统调用就会帮我们找到对应的码表然后找到对应的码位，然后展示对应的符号。<br>举个例子：对于汉字“一”，Unicode 码位是“4E00”。<br>我们在打印到显示器上的时候，可以提供这样的信息：</p>
<ol>
<li>utf8 + “1110 0100 1011 1000 1000 0000”</li>
<li>utf16 + “0100 1110 0000 0000”</li>
</ol>
<p>如果把 utf8 的明文 “1110 0100 1011 1000 1000 0000” 按照 utf8 的解码格式 <strong>1110xxxx 10xxxxxx 10xxxxxx</strong> 进行解码，会发现解码后，就是 “0100 1110 0000 0000”, 十六进制就是 “4E00”。<br>而 utf16 的明文本身就是 “0100 1110 0000 0000”, 十六进制就是 “4E00”。<br>所以他们都代表 Unicode 里面码位是 “4E00” 这个位置的符号，即汉字“一”。<br>所以你看， <strong>不管内存编码使用哪个，没有什么影响</strong> 。<br>而我们打印 int 类型 <strong>printf(“%d”,1);</strong> ，其实内部就是把 数字 1 转成字符串 1，然后默认使用 utf8 编码，就打印出来了。没啥区别，只是底层帮我们做了很多事情而已。</p>
<h3 id="图片文件如何存储"><a href="#图片文件如何存储" class="headerlink" title="图片文件如何存储"></a>图片文件如何存储</h3><p>有些累，不具体写了。和二进制一样，每种图片类型都有自己特定的二进制格式，比如文件头可以标记当前是什么格式的图片，图片不同的帧和信息可以通过不同的段进行存储。<br>还有那种渐进式图片，是通过将整个图片隔固定间距取一个值，这样就生成了整张图片的索引帧。间距越大，索引越小，缩略图也就越模糊。用不同的间距采样，就可以生成从模糊到逐渐清晰的索引帧。因为这样的图片解码和以往的图片解码不一样，所以需要特别的解码支持。直接在浏览器上面放置渐进式图片是不能直接解码索引帧的。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="followme">
  <span>Follow me by other channels</span>

  <div class="social-list">

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/hai_lv_">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/gongjiang">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="mailto:one.gongjiang@gmail.com">
            <span class="icon">
              <i class="fa fa-envelope"></i>
            </span>

            <span class="label">Email</span>
          </a>
      </div>

      <div class="social-item">
          <a target="_blank" class="social-link" href="/atom.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>

            <span class="label">RSS</span>
          </a>
      </div>
  </div>
</div>

          <div class="post-tags">
              <a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8E%9F%E7%90%86/" rel="tag"># 计算机原理</a>
              <a href="/tags/%E7%BC%96%E7%A0%81/" rel="tag"># 编码</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/%E5%86%85%E5%8D%B7/" rel="prev" title="内卷">
                  <i class="fa fa-angle-left"></i> 内卷
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/%E9%9A%8F%E6%97%B6%E9%97%B4%E7%9A%84%E5%8F%98%E5%8C%96/" rel="next" title="随时间的变化">
                  随时间的变化 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






      <div class="tabs tabs-comment">
        <ul class="nav-tabs">
            <li class="tab"><a href="#comment-gitalk">Light Mode (Better for light mode to discuss, base github, cannot commen can email me)</a></li>
            <li class="tab"><a href="#comment-utterances">Dark Mode</a></li>
        </ul>
        <div class="tab-content">
            <div class="tab-pane gitalk" id="comment-gitalk">
              <div class="comments gitalk-container"></div>
            </div>
            <div class="tab-pane utterances" id="comment-utterances">
              <div class="comments utterances-container"></div>
            </div>
        </div>
      </div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class=""></i>
    </span>
    <span class="author" itemprop="copyrightHolder">one.gongjiang艾特gmail.com 所有文章均为原创。我不介意任意形式的转载，但最好不要修改内容。因转载或者修改内容导致的任何问题，我均不负责。如果你真的担心版权，可邮联。评价需要外网，这是枷锁，也是照妖镜。</span>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.20/fancybox/fancybox.umd.js" integrity="sha256-q8XkJ6dj5VwSvzI8+nATCHHQG+Xv/dAZBCgqmu93zOY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  



  <script src="/js/third-party/fancybox.js"></script>



  




  <script src="https://cdnjs.cloudflare.com/ajax/libs/quicklink/2.3.0/quicklink.umd.js" integrity="sha256-yvJQOINiH9fWemHn0vCA5lsHWJaHs6/ZmO+1Ft04SvM=" crossorigin="anonymous"></script>
  <script class="next-config" data-name="quicklink" type="application/json">{"enable":true,"home":true,"archive":true,"delay":true,"timeout":3000,"priority":true,"url":"https://www.yigegongjiang.com/2022/%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E5%B7%AE%E5%BC%82-%E7%BC%96%E7%A0%81/"}</script>
  <script src="/js/third-party/quicklink.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"yigegongjiang","repo":"yigegongjiang_discuss","client_id":"65bebc0a049450012bda","client_secret":"06004e7143dc59f263a8d1bd1893dcf66d6bb7ee","admin_user":"yigegongjiang","distraction_free_mode":false,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"en","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"137c4491b9c89e57c10552a432fcd0e3"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"yigegongjiang/yigegongjiang_discuss","issue_term":"title","theme":"photon-dark"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
